<html>
    <head>
        <meta charset="UTF-8"/> 
        <title>Plasmid Clustering</title>
        <script language="javascript" type="text/javascript" src="vivagraph.js"></script>
        <script language="javascript" type="text/javascript" src="jquery-3.1.1.js"></script> 
        <script type="text/javascript">
        function getArray(){
                return $.getJSON('dict_temp_005_l4.json');
          }
            function onLoad() {
                var list=[];

                var g = Viva.Graph.graph();
                getArray().done(function(json){
	                $.each(json, function(sequence,pair){
	                	if (list.indexOf(sequence) < 0) {    //checks if sequence is not in list to prevent adding multiple nodes for each sequence
                      g.addNode(sequence);
                      list.push(sequence);
                      //console.log(sequence)
                      }
	                    $.each(pair, function(reference,dist){
	                      if (list.indexOf(reference) < 0) {    //checks if reference is not in list to prevent adding multiple nodes for each sequence
                          g.addNode(reference);
                          list.push(reference);
                          //console.log(pair)
                        }
	                      g.addLink(sequence,reference)
	                    });
	                });
                  console.log(list.length);

                    var layout = Viva.Graph.Layout.forceDirected(g, {
                       springLength : 30,
                       springCoeff : 0.0001,
                       dragCoeff : 0.01,
                       gravity : -1.2,
                       theta : 1
                    });

                    precompute(1000, renderGraph);

                    function precompute(iterations, callback) {
                      // let's run 10 iterations per event loop cycle:
                      var i = 0;
                      while (iterations > 0 && i < 10) {
                        layout.step();
                        iterations--;
                        i++;
                      }
                      //processingElement.innerHTML = 'Layout precompute: ' + iterations;
                      if (iterations > 0) {
                        setTimeout(function () {
                            //console.log(iterations);
                            precompute(iterations, callback);
                        }, 0); // keep going in next even cycle
                      } else {
                        // we are done!
                        callback();
                      }
                    }

                    function renderGraph(){
                        var graphics = Viva.Graph.View.webglGraphics();
                        var renderer = Viva.Graph.View.renderer(g, {
                            layout   : layout,
                            graphics : graphics,
                            container: document.getElementById('couve-flor')
                        });
                        renderer.run();
                        renderer.pause();
                    }

	            });

            }         

        </script>        
    </head>
    <body onload="onLoad()" style="height:100%;width:100%;">
    	<div id="couve-flor" style="height:100%;width:100%;"></div>
    </body>
</html>