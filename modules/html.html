<html>
    <head>
        <meta charset="UTF-8"/> 
        <!--<canvas id="myCanvas" width="200" height="100"></canvas>-->
        <title>Plasmid Clustering</title>
        <script language="javascript" type="text/javascript" src="vivagraph.js"></script>
        <script language="javascript" type="text/javascript" src="jquery-3.1.1.js"></script> 
        <script type="text/javascript">
			function getArray(){
                return $.getJSON('dict_temp_01.json');
            }
            function onLoad() {
                var g = Viva.Graph.graph();
                getArray().done(function(json){
	                $.each(json, function(sequence,pair){
	                	g.addNode(sequence)
	                    $.each(pair, function(reference,dist){
	                        g.addNode(reference)
	                        g.addLink(sequence,reference)
	                    })
	                })

                    var layout = Viva.Graph.Layout.forceDirected(g, {
                       springLength : 30,
                       springCoeff : 0.0008,
                       dragCoeff : 0.01,
                       gravity : -1.2,
                       theta : 1
                    });

                    precompute(1000, renderGraph);

                    function precompute(iterations, callback) {
                      // let's run 10 iterations per event loop cycle:
                      var i = 0;
                      while (iterations > 0 && i < 10) {
                        layout.step();
                        iterations--;
                        i++;
                      }
                      //processingElement.innerHTML = 'Layout precompute: ' + iterations;
                      if (iterations > 0) {
                        setTimeout(function () {
                            console.log(iterations);
                            precompute(iterations, callback);
                        }, 0); // keep going in next even cycle
                      } else {
                        // we are done!
                        callback();
                      }
                    }

                    function renderGraph(){
                        var graphics = Viva.Graph.View.webglGraphics();
                        var renderer = Viva.Graph.View.renderer(g, {
                            layout   : layout,
                            graphics : graphics,
                            container: document.getElementById('cenas')
                        });
                        renderer.run();
                        //renderer.pause();
                    }

	            });

            }         

        </script>        
       <!-- <script language="javascript" type="text/javascript" src="mashix_vect.js"></script> -->
    </head>
    <body onload="onLoad()" style="height:100%;width:100%;">
    	<div id="cenas" style="height:100%;width:100%;"></div>
    </body>
</html>